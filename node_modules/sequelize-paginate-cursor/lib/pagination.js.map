{"version":3,"sources":["../src/pagination.js"],"names":["Model","name","results","sinceId","maxId","limit","select","where","keyPaginated","reverse","include","subQuery","callback","lsThanE","lsThan","gsThan","findObject","findCursor","order","objects","findAll","attributes","nextCursor","undefined","len","length","lastCursor","findNextCursorWhere","findNextCursor","nextObject","findOne","objectReturn","err","any","paginate"],"mappings":";;;;;;;;AAAA;;;;kBAIe,UAACA,KAAD,EAA0B;AAAA,iFAAP,EAAO;;AAAA,MAAhBC,IAAgB,QAAhBA,IAAgB;;AACvC;AACA,QAAMC;AAAA,kCAAU,aAKE;AAAA,sFAAd,EAAc;;AAAA,UAJhBC,OAIgB,SAJhBA,OAIgB;AAAA,UAJPC,KAIO,SAJPA,KAIO;AAAA,8BAJAC,KAIA;AAAA,UAJAA,KAIA,+BAJQ,CAIR;AAAA,UAHhBC,MAGgB,SAHhBA,MAGgB;AAAA,8BAHRC,KAGQ;AAAA,UAHRA,KAGQ,+BAHA,EAGA;AAAA,qCAFhBC,YAEgB;AAAA,UAFhBA,YAEgB,sCAFD,IAEC;AAAA,gCAFKC,OAEL;AAAA,UAFKA,OAEL,iCAFe,KAEf;AAAA,gCADhBC,OACgB;AAAA,UADhBA,OACgB,iCADN,EACM;AAAA,iCADFC,QACE;AAAA,UADFA,QACE,kCADS,IACT;AAAA,UAAVC,QAAU;;AAChB,UAAI;AACF,cAAMC,UAAUJ,UAAU,MAAV,GAAmB,MAAnC;AACA,cAAMK,SAASL,UAAU,KAAV,GAAkB,KAAjC;AACA,cAAMM,SAASN,UAAU,KAAV,GAAkB,KAAjC;AACA,cAAMO,aAAaT,KAAnB;AACA,cAAMU,aAAa,EAAnB;;AAEA,YAAId,OAAJ,EAAa;AACXc,qBAAWJ,OAAX,IAAsBV,OAAtB;AACAa,qBAAWR,YAAX,IAA2BS,UAA3B;AACD;;AAED,YAAIb,KAAJ,EAAW;AACTa,qBAAWF,MAAX,IAAqBX,KAArB;AACAY,qBAAWR,YAAX,IAA2BS,UAA3B;AACD;;AAED;AACA,cAAMC,QAAQV,gBAAgBC,UAAU,EAAV,GAAe,OAA/B,CAAd;;AAEA;AACA,cAAMU,UAAU,MAAM,KAAKC,OAAL,CAAa;AACjCb,sBADiC;AAEjCI,4BAFiC;AAGjCD,0BAHiC;AAIjCL,sBAJiC;AAKjCgB,sBAAYf,MALqB;AAMjCY;AANiC,SAAb,CAAtB;;AASA,YAAII,aAAaC,SAAjB;AACA,cAAMC,MAAML,QAAQM,MAApB;;AAEA;AACA,YAAID,GAAJ,EAAS;AACP,gBAAME,aAAaP,QAAQK,MAAM,CAAd,EAAiBhB,YAAjB,CAAnB;AACA,gBAAMmB,sBAAsBpB,KAA5B;AACA,gBAAMqB,iBAAiB,EAAvB;AACAA,yBAAed,MAAf,IAAyBY,UAAzB;AACAC,8BAAoBnB,YAApB,IAAoCoB,cAApC;AACA;AACA,gBAAMC,aAAa,MAAM,KAAKC,OAAL,CAAa;AACpCvB,mBAAOoB,mBAD6B;AAEpChB,8BAFoC;AAGpCD,4BAHoC;AAIpCQ;AAJoC,WAAb,CAAzB;AAMA;AACA,cAAIW,UAAJ,EAAgB;AACdP,yBAAaO,WAAWrB,YAAX,CAAb;AACD;AACF;;AAED;AACA,cAAMuB,eAAe;AACnBZ,0BADmB;AAEnBG;AAFmB,SAArB;;AAKA;AACA,YAAIV,QAAJ,EAAc;AACZA,mBAAS,IAAT,EAAemB,YAAf;AACD;;AAED;AACA,eAAOA,YAAP;AACD,OAlED,CAkEE,OAAOC,GAAP,EAAY;AACZ;AACA,YAAIpB,QAAJ,EAAcA,SAASoB,GAAT;AACd,cAAMA,GAAN;AACD;AACF,KA7EK;;AAAA,aAAyBC,GAAzB;AAAA;AAAA;;AAAA,WAAyBA,GAAzB;AAAA,MAAN;AA8EA;AACA,MAAIhC,IAAJ,EAAU;AACRD,UAAMC,IAAN,IAAcC,OAAd;AACD,GAFD,MAEO;AACLF,UAAMkC,QAAN,GAAiBhC,OAAjB;AACD;AACF,C","file":"pagination.js","sourcesContent":["/**\n * Created by mirabalj on 10/12/16.\n */\n\nexport default (Model, { name } = {}) => {\n  // Pagination using cursor is here!\n  const results = async function any({\n    sinceId, maxId, limit = 1,\n    select, where = {},\n    keyPaginated = 'id', reverse = false,\n    include = [], subQuery = true,\n  } = {}, callback) {\n    try {\n      const lsThanE = reverse ? '$gte' : '$lte';\n      const lsThan = reverse ? '$gt' : '$lt';\n      const gsThan = reverse ? '$lt' : '$gt';\n      const findObject = where;\n      const findCursor = {};\n\n      if (sinceId) {\n        findCursor[lsThanE] = sinceId;\n        findObject[keyPaginated] = findCursor;\n      }\n\n      if (maxId) {\n        findCursor[gsThan] = maxId;\n        findObject[keyPaginated] = findCursor;\n      }\n\n      // Assign order of search\n      const order = keyPaginated + (reverse ? '' : ' DESC');\n\n      // Execute query with limit\n      const objects = await this.findAll({\n        where,\n        subQuery,\n        include,\n        limit,\n        attributes: select,\n        order,\n      });\n\n      let nextCursor = undefined;\n      const len = objects.length;\n\n      // Search fine? create a cursor!\n      if (len) {\n        const lastCursor = objects[len - 1][keyPaginated];\n        const findNextCursorWhere = where;\n        const findNextCursor = {};\n        findNextCursor[lsThan] = lastCursor;\n        findNextCursorWhere[keyPaginated] = findNextCursor;\n        // Find next cursor\n        const nextObject = await this.findOne({\n          where: findNextCursorWhere,\n          subQuery,\n          include,\n          order,\n        });\n        // Exist next cursor?\n        if (nextObject) {\n          nextCursor = nextObject[keyPaginated];\n        }\n      }\n\n      // Create paginate object\n      const objectReturn = {\n        objects,\n        nextCursor,\n      };\n\n      // Call back, Â¿exist?\n      if (callback) {\n        callback(null, objectReturn);\n      }\n\n      // Return paginate\n      return objectReturn;\n    } catch (err) {\n      // Catch error and send to callback\n      if (callback) callback(err);\n      throw err;\n    }\n  };\n  // Assign the function as the name identifier\n  if (name) {\n    Model[name] = results;\n  } else {\n    Model.paginate = results;\n  }\n};\n"]}